N <= 2000 , M <= 500 , D_i <= 1000
